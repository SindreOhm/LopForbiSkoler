<!DOCTYPE html>
<html land="no">
    <head>
    <meta charset="utf-8"/>
    <title>Kartverkskart</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="crossorigin=""></script>
        <style>
            #map {height: 800px;
                width: 600px }
        </style>
    </head>

    <body>

        <div id="app">
            <h1>Kart</h1>
            <div id="map"></div>
            <div v-if="!user">
                <a href="/.auth/login/aad">Login</a>
            </div>
            <div v-else>
                <span>Hei, {{ user.userDetails }}</span>
                <a href="/.auth/logout">Logout</a>
            </div>
        </div>

        <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
        <script type="text/javascript">
        const { createApp, ref, onMounted } = Vue;
        createApp({
            setup() {
                const user = ref(null);
                onMounted(async () => {
                    // Initialize map
                    var map = L.map('map').setView([60.14,10.25],9);
                    L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topo/default/webmercator/{z}/{y}/{x}.png', {
                        maxZoom: 18,
                        attribution: '&copy; <a href="http://www.kartverket.no/">Kartverket</a>'
                    }).addTo(map);
                    // Check authentication
                    try {
                        const res = await fetch('/.auth/me');
                        const data = await res.json();
                        if (data.clientPrincipal) {
                            user.value = data.clientPrincipal;
                        }
                    } catch (e) {
                        // Ignore errors
                    }
                });
                return { user };
            }
        }).mount('#app');
        </script>
    </body>

</html>
